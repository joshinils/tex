\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{header}[my collection of preamble stuff]

% option DarkMode, if present "inverts" the colors
% option eqInTOC, if present will put noon-* equations in the tableofcontents


\RequirePackage{amsmath,amssymb, a4, verbatim}
\RequirePackage[german]{babel}
%\RequirePackage[latin1]{inputenc}
\RequirePackage[utf8]{inputenc} % ueoeaess

\RequirePackage{csquotes}
\MakeOuterQuote{"}

\RequirePackage{listings} % fuer inline codelistings
\lstset{%
    basicstyle=\ttfamily,    % the size of the fonts
    columns=fixed,            % anything else is horrifying
    showspaces=false,        % show spaces using underscores?
    showstringspaces=false,    % underline spaces within strings?
    showtabs=false,            % show tabs within strings?
    xleftmargin=1.5em,        % left margin space
    breaklines=true,
    keywordstyle=\color{blue},
    commentstyle=\color[grey]{0.6},
    stringstyle=\color[RGB]{255,150,75}
}
\lstdefinestyle{inline}{basicstyle=\ttfamily}
\newcommand{\listline}[1]{\lstinline[style=inline]!#1!}

\RequirePackage{caption}
\newcommand{\tinycaption}[1]{\captionsetup{labelformat=empty}\caption{#1}}
\captionsetup{belowskip=-10pt, aboveskip=5pt}

%\RequirePackage{color}
%\RequirePackage{epsfig} % eps
\RequirePackage{graphicx} % eps
%\RequirePackage[shortcuts]{extdash}
%\RequirePackage{dsfont}
%\RequirePackage{epstopdf} % eps
%\RequirePackage[pdf]{pstricks} % eps
%\RequirePackage{auto-pst-pdf}
\RequirePackage{mathtools}
\RequirePackage{dsfont} % $ \mathds{1} $
\RequirePackage{icomma}
\RequirePackage{tikz}
%\RequirePackage{pgfplots}
%\pgfplotsset{compat=1.8}
\RequirePackage[bottom]{footmisc} % put footnotes at the bottom of page
\RequirePackage{nicefrac} % fuer brueche die aussehen wie prozentzeichen
% \RequirePackage{ps2pdf}
\usetikzlibrary{automata,positioning}

\RequirePackage{algorithmicx}
\RequirePackage{algpseudocode}
\RequirePackage{algorithm}

\RequirePackage{multicol}
\RequirePackage{wrapfig} % make stuff float
\RequirePackage{placeins} % stop stuff from floating
\RequirePackage{seqsplit} % very long numbers
\RequirePackage{framed} % begin{framed}

%  Headings and Footings :
\RequirePackage{fancyhdr}
%\headheight20pt
\lhead{\lheadcontent}

\chead{}
\rhead{\thepage}
\renewcommand{\headrulewidth}{.4pt}
\lfoot{\today}
\cfoot{}
\rfoot{\input{rfoot.tex}}
\renewcommand{\footrulewidth}{.4pt}

\RequirePackage[all=tight, charwidths=normal, wordspacing=normal, mathspacing=normal]{savetrees}

\RequirePackage{titletoc,tocloft}
\setlength{\cftsecindent}{0em}
\setlength{\cftsecnumwidth}{\widthof{1. }}

\setlength{\cftsubsecindent}{1.5em}
\setlength{\cftsubsecnumwidth}{\widthof{1.1. }}

\setlength{\cftsubsubsecindent}{3em}
\setlength{\cftsubsubsecnumwidth}{\widthof{1.1.1. }}

\setlength{\cftparaindent}{4.5em}
\setlength{\cftparanumwidth}{\widthof{1.1.1.1. }}

\RequirePackage{titlesec}
\titlespacing*{\section      }{0pt}{  2ex plus 0ex minus 0ex}{0ex plus 0ex}
\titlespacing*{\subsection   }{0pt}{1.5ex plus 0ex minus 0ex}{0ex plus 0ex}
\titlespacing*{\subsubsection}{0pt}{  1ex plus 0ex minus 0ex}{0ex plus 0ex}
\titlespacing*{\paragraph    }{0pt}{  1ex plus 0ex minus 0ex}{0ex plus 0ex} % same spacing as subsubsection
\titleformat{\paragraph}[hang]{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{} % different format, linebreak after
\titlespacing*{\subparagraph    }{0pt}{  1ex plus 0ex minus 0ex}{0ex plus 0ex} % same spacing as subsubsection
\titleformat{\subparagraph}[hang]{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{} % different format, linebreak after
\setcounter{secnumdepth}{10} % display more depth in the document
\setcounter{tocdepth}{10}% display more depth in the tableofcontents
\renewcommand{\theparagraph}{%
\ifnum\value{subsection} > 0
\ifnum\value{subsubsection} > 0
\thesubsubsection.\arabic{paragraph}%
\else
\thesubsection.\arabic{paragraph}%
\fi
\else
\thesection.\arabic{paragraph}%
\fi
}

\RequirePackage{array}
\RequirePackage{tabularx}

\RequirePackage{enumitem}
%\setlist[itemize]{noitemsep, align=left, leftmargin=*, itemindent=0pt, labelindent=0pt, itemsep=0pt, topsep=0pt, parsep=0pt,partopsep=0pt}
\setlist[itemize]{align = left, noitemsep, leftmargin=*, labelindent=0pt}

\oddsidemargin0.cm
\evensidemargin0.cm

\headsep20pt

\RequirePackage{calc}
\newlength{\afourwidth}
\setlength{\afourwidth}{210mm}

\renewcommand{\baselinestretch}{1}

%disallow hyphenation:
\hyphenpenalty=1000
\exhyphenpenalty=1500
\RequirePackage[]{geometry}
\setlength\textheight{10cm}
\geometry{
    a4paper,
    \pageOrientation,
    %paperheight=297mm, paperwidth=210mm,
    paperheight=297mm, paperwidth=\afourwidth*\real{\AfourWidthMult}, % multicols(2) but one one page width
    left=\somedistanceLeft,
    right=\somedistanceLeft,
    top=\somedistanceTop,
    bottom=.6\somedistanceTop,
    headheight=15pt,
    footskip=15pt,
}

\parindent0pt
\RequirePackage{parskip}

% https://tex.stackexchange.com/questions/198462/the-lightning-symbol-in-an-equation-environment
% \Lightning
\RequirePackage{marvosym}

\RequirePackage{lscape}

\newcommand{\R}{ {\mathbb R} }
\newcommand{\Z}{ {\mathbb Z} }
\newcommand{\C}{ {\mathbb C} }
\newcommand{\N}{ {\mathbb N} }
\newcommand{\e}{ {\,\mathrm e\,} }
\newcommand{\imag}{\/{\mathrm i}\/}
\newcommand{\jmag}{\/{\mathrm j}\/}
\newcommand{\1}{ {\mathds{1}} }
\newcommand{\abs}[1]{\lvert#1\rvert}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
\newcommand{\xt}{\tilde{x}}
\newcommand{\dotleq}{\dot{\leq}}
\newcommand{\m}{\hphantom{-} }
\newcommand{\dashfill}[1]{\vspace{11pt}\def\dashfill{\cleaders\hbox{#1}\hfill}\hbox to \hsize{\dashfill\hfil}\vspace{11pt}}
\newcommand{\scdot}{\!\cdot\!}
\newcommand{\sig}{\text{signum}}
\newcommand{\Hess}[1]{\mathop{\mathrm{H}}\nolimits#1}
\newcommand{\laplace}[1]{\mathop{{}\Delta}\nolimits#1}
\newcommand{\td}{\/\,\mathrm{d}}
\newcommand{\kommentar}[1]{}
\newcommand{\Real}[1]{\mathrm{Re}\left\{#1\right\}}
\newcommand{\Spur}[1]{\mathrm{Spur}\!\left(#1\right)}
\newcommand{\skalarprod}[2]{\left\langle#1;#2\right\rangle}
\newcommand{\scalarprod}[2]{\left\langle#1;#2\right\rangle}
\newcommand{\kreuzprod}[2]{#1\times#2}
\newcommand{\crossprod}[2]{\kreuzprod{#1}{#2}}

% a little altered: https://tex.stackexchange.com/questions/58628/optional-argument-for-newcommand
\renewcommand{\div}[1]{\ifthenelse{\equal{#1}{}}{\mathop{{}\mathrm{div}}\nolimits}{\mathrm{div}\left(#1\right)}}
\newcommand{\rot}[1]{\ifthenelse{\equal{#1}{}}{\mathop{{}\mathrm{rot}}\nolimits}{\mathrm{rot}\left(#1\right)}}
%\newcommand{\grad}[1]{\ifthenelse{\equal{#1}{}}{\mathop{{}\mathrm{grad}}\nolimits}{\mathrm{grad}\left(#1\right)}}


% https://tex.stackexchange.com/questions/2607/spacing-around-left-and-right
\let\originalleft\left
\let\originalright\right
\renewcommand{\left}{\mathopen{}\mathclose\bgroup\originalleft}
\renewcommand{\right}{\aftergroup\egroup\originalright}

% https://tex.stackexchange.com/questions/543318/command-with-optional-argument-in-parentheses-and-subscript
\RequirePackage{xparse}
\NewDocumentCommand{\Jacobi}{e{_}ge{_}}{%
    \operatorname{{}J}\nolimits\mathopen{}%
    \IfValueT{#1}{_{#1}}\IfValueT{#3}{_{#3}}%
    \IfValueT{#2}{\left(#2\right)}%
    \mathclose{}
}

\NewDocumentCommand{\grad}{g}{%
    \operatorname{{}\mathrm{grad}}\nolimits\mathopen{}%
    \IfValueTF{#1}{\left(#1\right)}%
    \mathclose{}
}

\newcommand{\test}[1]
{
    \operatorname{\mathrm{T}}
    \ifthenelse{\equal{#1}{}}{#1}{(#1)}
}

\newcommand{\quadfil}{\hskip 1em minus 1em}
\newcommand{\qquadfil}{\hskip 2em minus 2em}

% https://tex.stackexchange.com/questions/37080/how-can-i-indent-a-block-of-text-for-a-specified-amount/37084
\RequirePackage{scrextend}

% https://tex.stackexchange.com/questions/256894/how-to-make-underbrace-label-text-wrap-at-brace-width
\def\underbraceWrap#1_#2{%
    \setbox0=\hbox{$\displaystyle#1$}%
    \underbrace{\centering #1}_{\parbox[t]{\the\wd0}{\centering{#2}}}%
}

\everydisplay{\ifdim\predisplaysize=-\maxdimen \predisplaysize=\hsize \fi}
\RequirePackage{nccmath}

% https://tex.stackexchange.com/questions/238505/change-size-of-font-of-subscript-of-underbrace-in-align-environment/238510#238510
\RequirePackage{mathtools}
\RequirePackage{relsize}

% https://tex.stackexchange.com/questions/80378/red-squiggly-imitation
\RequirePackage[normalem]{ulem} % [normalem] to set \emph{} to default behaviour (italic instead of underlining)

\RequirePackage{xparse}
\NewDocumentCommand{\mcomm    }{ O{1fil} O{1em} }{\hskip #2 plus #1 minus #2 \quad\vert\;}
\NewDocumentCommand{\bigmcomm }{ O{1fil} O{1em} }{\hskip #2 plus #1 minus #2 \big\vert\;}
\NewDocumentCommand{\Bigmcomm }{ O{1fil} O{1em} }{\hskip #2 plus #1 minus #2 \Big\vert\;}
\NewDocumentCommand{\biggmcomm}{ O{1fil} O{1em} }{\hskip #2 plus #1 minus #2 \bigg\vert\;}
\NewDocumentCommand{\Biggmcomm}{ O{1fil} O{1em} }{\hskip #2 plus #1 minus #2 \Bigg\vert\;}
\NewDocumentCommand{\mcom     }{ O{1fil} O{1em} }{\hskip #2 plus #1 minus #2 \quad\vert\;}
\NewDocumentCommand{\bigmcom  }{ O{0pt}  O{0pt} }{\hskip #2 plus #1 minus #2 \big\vert\;}
\NewDocumentCommand{\Bigmcom  }{ O{0pt}  O{0pt} }{\hskip #2 plus #1 minus #2 \Big\vert\;}
\NewDocumentCommand{\biggmcom }{ O{0pt}  O{0pt} }{\hskip #2 plus #1 minus #2 \bigg\vert\;}
\NewDocumentCommand{\Biggmcom }{ O{0pt}  O{0pt} }{\hskip #2 plus #1 minus #2 \Bigg\vert\;}

\RequirePackage{setspace}

% https://tex.stackexchange.com/questions/57338/how-can-i-allow-gather-to-break-between-pages
\allowdisplaybreaks

%\renewcommand{\theequation}{\arabic{section}.\arabic{equation}}
%\numberwithin{equation}{section}

% https://tex.stackexchange.com/questions/264394/equation-number-syntax-section-subsection-subsubsection-equationnu
% \renewcommand{\theequation}{%
% \ifnum\value{subsection} > 0
% \ifnum\value{subsubsection} > 0
% \thesubsubsection--\arabic{equation}%
% \else
% \thesubsection--\arabic{equation}%
% \fi
% \else
% \thesection--\arabic{equation}%
% \fi
% }
\renewcommand{\theequation}{%
\ifnum\value{subsection} > 0
\ifnum\value{subsubsection} > 0
\thesubsubsection--\arabic{equation}%
\else
\thesubsection--\arabic{equation}%
\fi
\else
\thesection--\arabic{equation}%
\fi
}


\RequirePackage{tocloft}
\newcommand{\listequationsname}{List of Equations}
\newlistof{myequations}{equ}{\listequationsname}
\newcommand{\myequations}[1]{%
\addcontentsline{equ}{myequations}{\protect\numberline{\theequation}#1}\par}
\setlength{\cftmyequationsnumwidth}{2.5em}% Width of equation number in List of Equations

\RequirePackage{etoolbox}
% \AfterEndEnvironment{equation}{\myequations{}}
% \AfterEndEnvironment{align}{\myequations{}}

\newif\if@DarkMode\@DarkModefalse
\DeclareOption{DarkMode}{
  \@DarkModetrue
}
\newif\if@eqInTOC\@eqInTOCfalse
\DeclareOption{eqInTOC}{
  \@eqInTOCtrue
}
\ProcessOptions\relax

% https://tex.stackexchange.com/questions/119719/add-an-item-in-the-table-of-contents
\if@eqInTOC
    \newcommand{\addequation}{\addcontentsline{toc}{subsection}{Gleichung \theequation}}
    \AfterEndEnvironment{equation}{\addequation}
    \AfterEndEnvironment{align}{\addequation}
    %\AfterEndEnvironment{aligned}{\addequation}
    \AfterEndEnvironment{gather}{\addequation}
\fi

% https://tex.stackexchange.com/questions/207532/reset-equation-numbering-after-each-section
\RequirePackage{chngcntr}
\counterwithin*{equation}{section}
\counterwithin*{equation}{subsection}
\counterwithin*{equation}{subsubsection}

% https://tex.stackexchange.com/a/239589/202560
\AtBeginEnvironment{pmatrix}{\everymath{\displaystyle}}
\AtBeginEnvironment{bmatrix}{\everymath{\displaystyle}}

\RequirePackage{extarrows}

% define text and background-color
\RequirePackage{xcolor}

\if@DarkMode
    \xdefinecolor{bgcolor}{RGB}{33, 33, 33}
    \xdefinecolor{txcolor}{RGB}{220, 220, 220}
\else % bright mode
    \xdefinecolor{bgcolor}{RGB}{255, 255, 255}
    \xdefinecolor{txcolor}{RGB}{0, 0, 0}
\fi

\xdefinecolor{dark_red}{RGB}{165, 27, 11}
\pagecolor{bgcolor}
\makeatletter
\newcommand{\globalcolor}[1]{%
  \color{#1}\global\let\default@color\current@color
}
\makeatother
\AtBeginDocument{\globalcolor{txcolor}}

\xdefinecolor{HKS51}{rgb}{0,0.593,0.629}             % HKS51, BHT türkis
\xdefinecolor{HKS13}{rgb}{0.937,0.094,0.117}         % HKS13, BHT rot
\xdefinecolor{HKS51-dark70}{rgb}{0,0.198,0.20 }      % TFH türkis abgedunkelt
\xdefinecolor{lightgray}{gray}{0.9}
\xdefinecolor{lightGrey}{gray}{0.8}
% \xdefinecolor{lighterblue}{cyan}{0.9}
\xdefinecolor{lighterGrey}{gray}{0.9}


% https://tex.stackexchange.com/questions/42507/wrapfigure-cuts-off-images-at-the-end-of-the-page
% positions wrapfigure not too low on page
\makeatletter
\newcommand{\checkheight}[1]{%
  \par \penalty-100\begingroup%
  \setbox8=\hbox{#1}%
  \setlength{\dimen@}{\ht8}%
  \dimen@ii\pagegoal \advance\dimen@ii-\pagetotal
  \ifdim \dimen@>\dimen@ii
    \break
  \fi\endgroup}
\makeatother

% https://tex.stackexchange.com/questions/180325/boxed-equation-with-number/180326
\input{\string ~/tex/tcbDefinitions.tex}


\RequirePackage{blindtext}

% https://tex.stackexchange.com/questions/518936/using-computer-modern-int-symbol-with-txfonts-math-font
% https://github.com/joshinils/tex/blob/master/greek.tex
\RequirePackage{newtxtext}% For text font
\RequirePackage{newtxmath}

\RequirePackage{upgreek}
%\RequirePackage{unicode-math}
%\unimathsetup{math-style=french}
\renewcommand{\alpha  }{\alphaup   }
\renewcommand{\epsilon}{\varepsilon}
\renewcommand{\phi    }{\varphi    }
%\renewcommand{\theta  }{\upvartheta}
\renewcommand{\gamma  }{\gammaup   }
\renewcommand{\sigma  }{\sigmaup   }
\renewcommand{\lambda }{\lambdaup  }

\DeclareSymbolFont{largesymbolscmr}{OMX}{cmex}{m}{n}
\DeclareMathSymbol{\intop}{\mathop}{largesymbolscmr}{"52}
\DeclareRobustCommand\int{\intop\nolimits}

\DeclareSymbolFont{largeesint}{U}{esint}{m}{n}
\DeclareMathSymbol{\cmriintop}{\mathop}{largeesint}{"03}
\DeclareRobustCommand\iint{\cmriintop\nolimits}

% https://tex.stackexchange.com/questions/3622/best-way-to-generate-nice-function-plots-in-latex
\usetikzlibrary{datavisualization}
\usetikzlibrary{datavisualization.formats.functions}

\RequirePackage{fonttable}

\RequirePackage[range-phrase=\text{ bis },exponent-product=\cdot, per-mode=symbol, output-decimal-marker={,}]{siunitx}
\sisetup{locale = DE}

% makes nested parentheses bigger
\delimitershortfall=-.5pt

\RequirePackage[hyphens]{url}
\RequirePackage[colorlinks = false]{hyperref}

% https://tex.stackexchange.com/questions/339682/how-to-really-solve-the-problem-of-underfull-hbox-when-typesetting-url-in-f
\Urlmuskip=0mu plus 10mu

\RequirePackage{cancel}

% https://tex.stackexchange.com/questions/82782/footnote-in-align-environment
\makeatletter
\newcommand{\AlignFootnote}[1]{%
  \ifmeasuring@
    \chardef\@tempfn=\value{footnote}%
    \footnotemark
    \setcounter{footnote}{\@tempfn}%
  \else
    \iffirstchoice@
      \footnote{#1}%
    \fi
  \fi}
\makeatother

\endinput
