% https://tex.stackexchange.com/questions/180325/boxed-equation-with-number/180326
\usepackage[most]{tcolorbox}

\colorlet{titleBackColor}{HKS51!20!bgcolor}
\colorlet{redBackColor}{HKS13!20!bgcolor}
\colorlet{frameColor}{HKS51}
\colorlet{grayBackColor}{lightGrey!25!bgcolor}
\colorlet{faintTitleBack}{titleBackColor!10!bgcolor}
\colorlet{faintredBack}{redBackColor!33!bgcolor}
\newlength{\boxseppadding}
\setlength{\boxseppadding}{3pt}

\colorlet{YellowGreen}{yellow!50!green} % todo

\newlength{\leftpadding}
\setlength{\leftpadding}{3pt}
\newlength{\rightpadding}
\setlength{\rightpadding}{\leftpadding}

\newtcolorbox{aufgabe}{%
%\tcbset{
    colback=HKS51!5!bgcolor, colframe=frameColor, coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    enforce breakable=true,
    colbacktitle=titleBackColor,
}

\newtcolorbox{alteAufgabe}{%
    colback=gray!25!bgcolor,
    colframe=gray!25!bgcolor,
    coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =0pt,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    colbacktitle=titleBackColor,
}

\newtcolorbox{nebenrechnung}{%
    colback=bgcolor,
    colframe=gray!25!bgcolor,
    coltext=txcolor,
    coltitle=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
    colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=3pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    title={Nebenrechnung},
    colbacktitle=titleBackColor,
}

\newtcolorbox{frage}{
    enhanced,
    skin=bicolor,
    lower separated=true,
    middle=0pt,
    colback=red!60!txcolor,
    colbacklower=green!50!txcolor,
    colframe=frameColor,
    coltext=bgcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    colbacktitle=titleBackColor,
}

\newtcolorbox{antwort}{
    colback=green!50!txcolor, colframe=HKS51-dark70!50!txcolor, coltext=bgcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    subtitle style={colback=green!50!txcolor,boxrule=0pt}
    colbacktitle=titleBackColor,
}

\newtcolorbox{markText}{
    colback=YellowGreen!50!bgcolor, colframe=frameColor, coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    colbacktitle=titleBackColor,
}

\def\titleTodo{{\todo[gleichung oder benennung als titel]}}
\newtcolorbox{satz}[1][\titleTodo]{
    colback=grayBackColor, colframe=frameColor, coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    title = \textbf{Satz \arabic{satzNumber}} ~#1 \phantomsection\addcontentsline{toc}{subsection}{Satz \arabic{satzNumber} #1},
    coltitle=txcolor,
    colbacktitle=titleBackColor,
%    before upper = \tcbsubtitle{\textbf{Satz \arabic{satzNumber}} ~#1 \phantomsection\addcontentsline{toc}{subsection}{Satz \arabic{satzNumber} #1}},
    before lower = \tcbsubtitle{\textbf{Beweis:}},
    subtitle style = {
        frame empty,
    },
    enhanced,
    skin=bicolor,
    lower separated=true,
    middle=0pt,
    colbacklower=grayBackColor,
}

\AtBeginEnvironment{satz}{\satzEquations}
\AtEndEnvironment{satz}{\restoresatzequations}
\newcounter{satzsavedequation}
\newcounter{satzNumber}
\setcounter{satzNumber}{0}

\newcommand{\satzEquations}{%
  \setcounter{satzsavedequation}{\value{equation}}%
  \setcounter{equation}{0}%
  \stepcounter{satzNumber}
  \renewcommand{\theequation}{S\/\arabic{satzNumber}--\arabic{equation}}%
}

\newcommand{\restoresatzequations}{%
  \setcounter{equation}{\value{satzsavedequation}}%
}

\AtBeginEnvironment{satz}{
    \if@eqInTOC
        \renewcommand{\addequation}{\phantomsection\addcontentsline{toc}{subsubsection}{Gleichung \theequation}}
    \fi
}

\newtcolorbox{proof}[1][\titleTodo]{
    colback=faintTitleBack, colframe=frameColor, coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    title = \textbf{Beweis \arabic{proofNumber}} ~#1  \phantomsection\addcontentsline{toc}{subsection}{Beweis \arabic{definitionNumber} #1},
    coltitle=txcolor,
    colbacktitle=titleBackColor,
}

\AtBeginEnvironment{proof}{\proofEquations}
\AtEndEnvironment{proof}{\restoreproofequations}
\newcounter{proofsavedequation}
\newcounter{proofNumber}
\setcounter{proofNumber}{0}

\newcommand{\proofEquations}{%
  \setcounter{proofsavedequation}{\value{equation}}%
  \setcounter{equation}{0}%
  \stepcounter{proofNumber}
  \renewcommand{\theequation}{W\/\arabic{proofNumber}--\arabic{equation}}%
}

\newcommand{\restoreproofequations}{%
  \setcounter{equation}{\value{proofsavedequation}}%
}
\AtBeginEnvironment{proof}{
    \if@eqInTOC
        \renewcommand{\addequation}{\phantomsection\addcontentsline{toc}{subsubsection}{Gleichung \theequation}}
    \fi
%   \phantomsection\addcontentsline{toc}{subsection}{Beweis \arabic{proofNumber}}
}

\newtcolorbox{definition}[1][\titleTodo]{
    colback=grayBackColor, colframe=frameColor, coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    title = \textbf{Definition \arabic{definitionNumber}} ~#1  \phantomsection\addcontentsline{toc}{subsection}{Definition \arabic{definitionNumber} #1},
    coltitle=txcolor,
    colbacktitle=titleBackColor,
    title style={
        boxsep=10pt,
    },
}

\AtBeginEnvironment{definition}{\definitionEquations}
\AtEndEnvironment{definition}{\restoredefinitionequations}
\newcounter{definitionsavedequation}
\newcounter{definitionNumber}
\setcounter{definitionNumber}{0}

\newcommand{\definitionEquations}{%
  \setcounter{definitionsavedequation}{\value{equation}}%
  \setcounter{equation}{0}%
  \stepcounter{definitionNumber}
  \renewcommand{\theequation}{D\/\arabic{definitionNumber}--\arabic{equation}}%
}

\newcommand{\restoredefinitionequations}{%
  \setcounter{equation}{\value{definitionsavedequation}}%
}
\AtBeginEnvironment{definition}{
    \if@eqInTOC
        \renewcommand{\addequation}{\phantomsection\addcontentsline{toc}{subsubsection}{Gleichung \theequation}}
    \fi
}

\newtcolorbox{wichtig}{
    colback=grayBackColor, colframe=frameColor, coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    colbacktitle=titleBackColor,
}

\newtcolorbox{anmerkung}{
    colback=faintredBack, colframe=frameColor, coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    colbacktitle=titleBackColor,
}

\xdefinecolor{notBrightGreen}{rgb}{0.2, 0.9, 0.2}

\newcounter{exampleNumber}
\setcounter{exampleNumber}{0}
\newtcolorbox[use counter=exampleNumber]{example}[2][]{
    enhanced,
    skin=bicolor,
    lower separated=true,
    before upper = \vspace{2pt},
    middle=0pt,
    colback=orange!25!bgcolor,
    colbacklower=notBrightGreen!25!bgcolor,
    colframe=frameColor,
    coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    title = \textbf{Beispiel \theexampleNumber} ~#2 \phantomsection\addcontentsline{toc}{subsection}{Beispiel \theexampleNumber~#2},
    phantomlabel=#1,
    coltitle=txcolor,
    colbacktitle=titleBackColor,
}
\renewcommand{\theexampleNumber}{B\arabic{exampleNumber}}

% https://tex.stackexchange.com/questions/374620/separate-equation-numbering-in-algorithm-environment
\newcounter{examplesavedequation}
\AtBeginEnvironment{example}{
    \setcounter{examplesavedequation}{\value{equation}}
    \setcounter{equation}{0}
    \renewcommand{\theequation}{\theexampleNumber--\arabic{equation}}
    \if@eqInTOC
        \renewcommand{\addequation}{\phantomsection\addcontentsline{toc}{subsubsection}{Gleichung \theequation}}
    \fi
}
\AtEndEnvironment{example}{
    \setcounter{equation}{\value{examplesavedequation}}
}

\newtcolorbox{solution}{
    colback=notBrightGreen!50!bgcolor, colframe=frameColor, coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    title=\fett{Lösung:},
    coltitle=txcolor,
    colbacktitle=titleBackColor,
}

\newtcolorbox{orangecolorbox}{
    colback=orange!75!bgcolor, colframe=frameColor, coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    colbacktitle=titleBackColor,
}

\newtcolorbox{lightgraycolorbox}{
    colback=lightgray!75!bgcolor, colframe=lightgray!75!txcolor, coltext=txcolor,
    highlight math style= {enhanced, %<-- needed for the ’remember’ options
        colframe=HKS51, colback=bgcolor, boxsep=0pt},
    boxrule=.75pt,
    arc=0pt,
    boxsep =\boxseppadding,
    left   =\leftpadding,
    right  =\rightpadding,
    top    =0pt,
    bottom =0pt,
    breakable=true,
    colbacktitle=titleBackColor,
}
